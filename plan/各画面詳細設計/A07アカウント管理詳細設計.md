# A07 アカウント管理詳細設計

## 1. 画面概要

管理システムのログインアカウント自体の管理を行う。

## 2. 必要なフォームデータ

### 2.1. 基本情報

- `login_name`: ログインID（NotNull）
- `email`: メールアドレス（NotNull）
- `icon_path`: アイコン画像のパス

### 2.2. アドミン権限（新規招待・管理時）

- `role`: `admin` / `user`（NotNull）
- `status`: `active` / `banned`

### 2.3. パスワードルール

- 8〜12文字であること。
- 半角英字および半角数字をそれぞれ1文字以上含むこと。

## 3. I/O（API フォーマット）

### 3.1. アカウント一覧取得

- **メソッド**: `GET`
- **エンドポイント**: `/api/admin/accounts`

#### Response JSON

```json
{
  "accounts": [
    {
      "account_id": 1,
      "login_name": "admin_user",
      "email": "admin@example.com",
      "role": "admin",
      "status": "active",
      "last_login_at": "2026-01-18T10:00:00Z"
    },
    {
      "account_id": 2,
      "login_name": "creator_01",
      "email": "c01@example.com",
      "role": "user",
      "status": "active",
      "last_login_at": "2026-01-17T15:00:00Z"
    }
  ]
}
```

### 3.2. アカウント作成

- **メソッド**: `POST`
- **エンドポイント**: `/api/admin/accounts`

#### Request JSON

```json
{
  "login_name": "new_user",
  "email": "new@example.com",
  "role": "user"
}
```

※パスワードはシステムでワンタイムパスワード（OTP）を生成し、入力されたメールアドレスに送信される。

### 3.3. アカウント情報編集（ロール変更・BAN等）

- **メソッド**: `POST`
- **エンドポイント**: `/api/admin/accounts/{id}`

#### Request JSON

```json
{
  "email": "updated@example.com",
  "role": "admin",
  "status": "active"
}
```

### 3.4. パスワードリセット

- **メソッド**: `POST`
- **エンドポイント**: `/api/admin/accounts/{id}/password`

#### Request JSON

```json
{
  "current_password": "otp_or_old_password",
  "new_password": "new_secure_password"
}
```

### 3.5. パスワード変更要請チェック（ログイン時）

- **メソッド**: 'GET'
- **エンドポイント**: `/api/auth`

### **Response JSON**:

```json
{
  "user": { ... },
  "needs_password_change": true
}
```

※`needs_password_change` が true の場合、フロントエンドは強制的にパスワード変更画面へ遷移させる。
