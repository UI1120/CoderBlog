# A03 記事管理・コメント管理 詳細設計

## 1. 画面概要
全記事（公開・下書き・予約含む）の管理、および投稿されたコメントの確認・管理を行う。
画面上部のタブで「記事一覧」と「コメント一覧」を切り替えて操作する。

## 2. 記事管理（タブ1）

### 2.1. 必要なフォームデータ（フィルタ・検索）
- `keyword`: タイトル等のキーワード検索
- `status`: 記事ステータス（draft / published / scheduled / private）
- `category_id`: カテゴリ絞り込み
- `writer_id`: 執筆者絞り込み

### 2.2. I/O（API フォーマット）

#### 記事一覧取得
- **メソッド**: `GET`
- **エンドポイント**: `/api/admin/articles`
- **Query Parameters**: `?keyword=...&status=...&category_id=...&writer_id=...`

##### Response JSON
```json
{
  "articles": [
    {
      "article_id": 1,
      "title": "ロボット制御の基本",
      "writer_name": "山田太郎",
      "category_name": "ロボット",
      "status": "published",
      "published_at": "2026-01-10T12:00:00Z",
      "updated_at": "2026-01-10T12:00:00Z",
      "comment_count": 5
    }
  ],
  "total_count": 50,
  "page": 1
}
```

#### ステータス変更（個別）
- **メソッド**: `POST`
- **エンドポイント**: `/api/admin/articles/{id}/status`
- **Request JSON**: `{"status": "published"}`

#### 記事削除
- **メソッド**: `POST`
- **エンドポイント**: `/api/admin/articles/{id}` (Body: `{"action": "delete"}`)

---

## 3. コメント管理（タブ2）

### 3.1. 画面概要
全ての記事に対するコメントを時系列順または記事ごとに一覧表示し、不適切なコメントの削除等を行う。

### 3.2. 必要なフォームデータ（フィルタ・検索）
- `keyword`: コメント本文や投稿者名の検索
- `article_id`: 特定の記事に紐付くコメントのみ抽出（任意）
- `status`: コメントステータス（pending / approved / rejected / all）

### 3.3. I/O（API フォーマット）

#### コメント一覧取得
- **メソッド**: `GET`
- **エンドポイント**: `/api/admin/comments`
- **Query Parameters**: `?keyword=...&article_id=...&status=...`

##### Response JSON
```json
{
  "comments": [
    {
      "comment_id": 101,
      "article_id": 1,
      "article_title": "ロボット制御の基本",
      "guest_name": "名無しのエンジニア",
      "content": "非常に参考になりました！",
      "status": "pending",
      "ip_address": "192.168.1.1",
      "created_at": "2026-01-18T10:00:00Z"
    }
  ],
  "total_count": 200,
  "page": 1
}
```

#### ステータス更新（承認・拒否）
- **メソッド**: `POST`
- **エンドポイント**: `/api/admin/comments/{id}/status`
- **Request JSON**:
```json
{
  "status": "approved" 
}
```
※ `pending` のコメントは、表側（一般公開側）では「現在 管理人の承認待ちです」というメッセージに置き換えて表示される。`approved` に変更した時点で本文が一般公開される。`rejected` は完全に非表示となる。

#### コメント削除（物理削除）
- **メソッド**: `POST`
- **エンドポイント**: `/api/admin/comments/{id}`
- **Request JSON**: `{"action": "delete"}`

##### Response JSON
```json
{
  "status": "success",
  "message": "Comment processed"
}
```
